[^日期]: 2021年2月1日



# 栈、堆、方法区的交互关系

## 运行时数据区结构图

### 整体结构图

![image-20210201104933804](https://gitee.com/clancy/images/raw/master/img/image-20210201104933804.png)



### 从线程共享与否的角度来看

![image-20210201105243643](https://gitee.com/clancy/images/raw/master/img/image-20210201105243643.png)

## 存储关系图

![image-20210201105708063](https://gitee.com/clancy/images/raw/master/img/image-20210201105708063.png)



# 方法区的理解

## [官网解读](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.5.4)

> ### 2.5.4. Method Area
>
> The Java Virtual Machine has a *method area* that is shared among all Java Virtual Machine threads. The method area is analogous to the storage area for compiled code of a conventional language or analogous to the "text" segment in an operating system process. It stores per-class structures such as the run-time constant pool, field and method data, and the code for methods and constructors, including the special methods ([§2.9](https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-2.html#jvms-2.9)) used in class and instance initialization and interface initialization.
>
> The method area is created on virtual machine start-up. Although the method area is logically part of the heap, simple implementations may choose not to either garbage collect or compact it. This specification does not mandate the location of the method area or the policies used to manage compiled code. The method area may be of a fixed size or may be expanded as required by the computation and may be contracted if a larger method area becomes unnecessary. The memory for the method area does not need to be contiguous.
>
> A Java Virtual Machine implementation may provide the programmer or the user control over the initial size of the method area, as well as, in the case of a varying-size method area, control over the maximum and minimum method area size.
>
> The following exceptional condition is associated with the method area:
>
> - If memory in the method area cannot be made available to satisfy an allocation request, the Java Virtual Machine throws an `OutOfMemoryError`.

## 方法区在哪里？

《Java虚拟机规范》中明确说明:“尽管所有的方法区在逻辑上是属于堆的一部分,但些简单的实现可能不会选择去进行垃圾收集或者进行压缩。”但对于 HotspotJVM而言,方法区还有一个别名叫做Non-Heap（非堆）,目的就是要和堆分开。
**所以,方法区看作是一块独立于Java堆的内存空间。**

![image-20210201111159887](https://gitee.com/clancy/images/raw/master/img/image-20210201111159887.png)













# 设置方法区大小与OOM





# 方法区的内部结构





# 方法区的使用举例





# 方法区的演进细节







# 方法区的垃圾回收





# 总结